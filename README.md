# 추천 API

### 요구사항
요구사항 구현 여부, 구현 방법, 검증
결과에 대해 작성합니다.
* 8개 카테고리에 상품을 하나씩 구매하여, 코디를 완성하는 서비스 제공 
  1. 고객은 카테고리 별로 최저가격인 브랜드와 가격을 조회하고 총액이 얼마인지 확인할 수 있어야 합니다.
  2. 고객은 단일 브랜드로 전체 카테고리 상품을 구매할 경우 최저가격인 브랜드와 총액이 얼마인지 확인할 수 있어야 합니다.
  3. 고객은 특정 카테고리에서 최저가격 브랜드와 최고가격 브랜드를 확인하고 각 브랜드 상품의 가격을 확인할 수 있어야 합니다.
  4. 운영자는 새로운 브랜드를 등록하고, 모든 브랜드의 상품을 추가, 변경, 삭제할 수 있어야 합니다.

---

### 제약 조건

* 동일 브랜드 + 카테고리 상품은 1개씩만 등록 가능하다.
* 신규 브랜드 상품은 브랜드 정보가 먼저 저장되어야 한다.
* 카테고리 정보는 category 테이블 priority 우선순위(오름차순) 기준으로 노출순서가 정해진다.
* 카테고리에 가격이 동일한 상품은 product 테이블의 priority 우선순위가 높은 상품으로 조회된다. 

---

### 구현 방법

* 카테고리 별 최저가 조회 / 브랜드 상품 합이 최저가격인 브랜드 조회 / 특정 카테고리의 최저가 조회 API 의 경우 cache 되어 응답된다.
* 브랜드 정보 / 상품정보가 변경될 경우 cache 정보는 초기화된다.
* 상품정보 변경 / 삭제는 lock 처리되어 순서대로 처리된다.
* 서비스 기동시 브랜드별 가격의 합을 계산해 brand 테이블의 total_price 총 가격 컬럼에 저장한다.

---

### 검증 방법
 * 아래 3개 테스트 파일 실행으로 API 검증한다.
```
    RecommendationTest.class
    ProductServiceTest.class
    RecommendationServiceTest 
```
---       


### 제공 API
>* 서비스 기동시 'calculateTotalPrice4Init()' 메서드가 기동되면서 브랜드별 최저가격을 저장한다.
>  * (POST) http://localhost:8080/products/category/calculate


>* 고객은 카테고리 별로 최저가격인 브랜드와 가격을 조회하고 총액이 얼마인지 확인할 수 있어야 합니다.
>  * (GET) http://localhost:8080/products/category/min-price


>* 고객은 단일 브랜드로 전체 카테고리 상품을 구매할 경우 최저가격인 브랜드와 총액이 얼마인지 확인할 수 있어야 합니다.
>  * (GET) http://localhost:8080/products/category/min-price/total


>* 고객은 특정 카테고리에서 최저가격 브랜드와 최고가격 브랜드를 확인하고 각 브랜드 상품의 가격을 확인할 수 있어야 합니다.
>  * (GET) http://localhost:8080/products/category/:categoryCd/price-range


>* 운영자는 새로운 브랜드를 등록하고, 모든 브랜드의 상품을 추가, 변경, 삭제할 수 있어야 합니다.
>  * 브랜드 등록 
>    * (POST) http://localhost:8080/brands
>    ```
>       {
>                "brandCd" : "X",
>                "brandName": "x브랜드명"
>        }     
>    ```
>  * 브랜드 수정
>    * (POST) http://localhost:8080/brands
>    ```
>    {
>             "brandCd" : "X",
>             "brandName": "x브랜드명 수정"
>     }     
>      ```
>  * 브랜드 삭제
>    * (DELETE) http://localhost:8080/brands/:brandCd
>  * 상품 조회
>    * (GET) http://localhost:8080/products/:productNo
>  * 상품 등록 (동일 브랜드/카테고리 상품은 1개만 등록 가능)
>      * (POST) http://localhost:8080/products
>          ```
>              {
>                  "categoryCd" : "TOP",
>                  "name" : "A브랜드 상품",
>                  "price" : 100,
>                  "count" : 10,
>                  "brandCd" : "A",
>                  "requestUserNo" : 200,
>                  "productNo": 1,
>                  "priority": 100,
>                  "saleStatus": "SALE"
>              }
>          ```  
>  * 상품 수정 (동일 브랜드/카테고리 상품은 1개만 등록 가능)
>      * (PUT) http://localhost:8080/products
>          ```
>              {
>                  "categoryCd" : "TOP",
>                  "name" : "A브랜드 상품",
>                  "price" : 100,
>                  "count" : 10,
>                  "brandCd" : "A",
>                  "requestUserNo" : 200,
>                  "productNo": 1,
>                  "priority": 100,
>                  "saleStatus": "SALE"
>              }
>          ```  
>  * 상품 삭제
>      * (DELETE) http://localhost:8080/products/:productNo

---

### 응답 코드 

|응답코드|메시지|비고|
|------|---|---|
|0000|정상||
|ER0001|브랜드 정보가 없습니다.||
|ER0002|상품 정보가 없습니다.||
|ER0003|브랜드의 상품 정보가 없습니다.||
|ER0004|카테고리 정보가 없습니다.||
|ER0005|요청하신 정보중 브랜드 코드가 존재하지 않습니다.||
|ER0006|요청하신 정보중 브랜드 이름이 존재하지 않습니다.||
|ER0007|삭제할 브랜드 코드가 존재하지 않습니다.||
|ER0008|요청하신 정보 중 카테고리 코드가 존재하지 않습니다.||
|ER0009|요청하신 정보 중 상품 이름이 존재하지 않습니다.||
|ER0010|요청하신 정보 중 상품 수량이 존재하지 않습니다.||
|ER0011|요청하신 정보 중 사용자 정보가 존재하지 않습니다.||
|ER0012|삭제할 상품 번호가 존재하지 않습니다.||
|ER0013|판매 상태를 찾을 수 없습니다.||
|ER0014|동일 브랜드/카테고리가 이미 존재합니다.||
|ER0015|동일 브랜드가 이미 존재합니다.||
|ER0016|요청하신 정보 중 상품번호가 존재하지 않습니다.||
|ER0017|요청하신 정보 중 상품 판매 상태가 존재하지 않습니다.||
|ER0018|삭제하려는 브랜드의 상품이 존재합니다. 상품부터 삭제되어야 합니다.||
|ER0019|요청하신 정보 중 노출 우선순위가 존재하지 않습니다.||


